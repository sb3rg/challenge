{
    "collab_server" : "",
    "contents" : "source( \"../+Helpers/helpers.R\" )\n# install.packages( \"DiagrammeR\" )\n# install.packages( \"DiagrammeRsvg\" )\n# install.packages( \"htmltools\" )\n# install.packages(\"extrafont\")\n\n# library( DiagrammeR )\n# library( DiagrammeRsvg )\n# library( htmltools )\nlibrary(scales)\nlibrary(extrafont)\n# font_import()\n# loadfonts(\"win\")\n# fonts()\nlibrary(RColorBrewer)\nlibrary(grid)    # for pmax\nlibrary(gridExtra) # to arrange the plots\nlibrary(ggridges) # for ridge plots\n\n\n## --- IMPORT AND COMBINE DATA ---\nraw <- read.csv(\"Data.csv\", stringsAsFactors = F)\ncopy <- raw %>% copy() %>% as.data.table()\n\n\n\n\n\n### --- VISUALIZE ARRIVALS BY HOUR--- ###\narrivals <- copy$Arrival.Date...Time %>% add_date_prop_DT()\n\narrivals %>%\n  ## STAT GRAPHICS\n  ggplot(aes(x=hour, y = ..count../sum(..count..)))+ #base graph with x and y specified\n  stat_bin(binwidth=1, colour=\"white\", fill = \"#FDB913\")+ #layer bar graph\n  stat_bin(binwidth=1, geom=\"text\", family=\"Segoe UI Light\", vjust=1.5, size=3.5, aes(label = scales::percent(..count../sum(..count..))))+ #layer data labels to each bar\n  ## TITLES & AXES\n  labs( # draw labels\n    title=\"Arrival Distribution\", \n    subtitle = \"1 Jan 2018 to 31 Dec 2018\",\n    y = \"Relative Frequency\",\n    x = \"Hour of Day\"\n  )+\n  ## SCALES\n  scale_x_continuous(breaks=seq(0,23,1))+ #scale x axis from 0 to 23 with intervals of 1\n  scale_y_continuous(labels=scales::percent_format(accuracy=1))+ #set y axis to percent\n  ## ANNOTATIONS\n  annotate(\"segment\", x=16.5, xend=20.5, y=.1, yend=.1, colour=\"#E63933\", arrow=arrow(ends=\"both\", angle=90, length=unit(0.1,\"in\")))+\n  annotate(\"text\", x=17+(20-17)/3, y=.103, colour=\"#E63933\", label=\"Peak Hours\")+\n  ## THEMES\n  theme_classic()+ #clean theme\n  theme(text=element_text(family=\"Segoe UI Light\"))\n\n## SAVE\nggsave(path=\"./plots\", filename=\"arrival_dist.png\", height = 4.78, width = 8.75, units = \"in\", device = \"png\" )\n\n\n\n\n\n\n### --- VISUALIZE ARRIVALS BY DAY OF WEEK --- ###\narrivals <- copy$Arrival.Date...Time %>% add_date_prop_DT()\n\narrivals %>%\n  ## STAT GRAPHICS\n  ggplot(aes(x=wday, y = ..count../sum(..count..)))+ #base graph with x and y specified\n  coord_flip()+\n  stat_bin(binwidth=1, colour=\"white\", fill = \"#FDB913\")+ #layer bar graph\n  stat_bin(binwidth=1, geom=\"text\", family=\"Segoe UI Light\", vjust=1.5, size=3.5, aes(label = scales::percent(..count../sum(..count..))))+ #layer data labels to each bar\n  ## TITLES & AXES\n  labs( # draw labels\n    title=\"Arrivals by Day\", \n    subtitle = \"1 Jan 2018 to 31 Dec 2018\",\n    y = \"Relative Frequency\",\n    x = \"Day of Week\"\n  )+\n  ## SCALES\n  scale_x_reverse(breaks=1:7, labels=c(\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"))+ #scale x axis from 0 to 23 with intervals of 1\n  scale_y_continuous(labels=scales::percent_format(accuracy=1))+ #set y axis to percent\n  ## ANNOTATIONS\n  # annotate(\"segment\", x=16.5, xend=20.5, y=.1, yend=.1, colour=\"#E63933\", arrow=arrow(ends=\"both\", angle=90, length=unit(0.1,\"in\")))+\n  # annotate(\"text\", x=17+(20-17)/3, y=.103, colour=\"#E63933\", label=\"Peak Hours\")+\n  ## THEMES\n  theme_classic()+ #clean theme\n  theme(text=element_text(family=\"Segoe UI Light\"))\n\n## SAVE\nggsave(path=\"./plots\", filename=\"arrivals_by_day.png\", height = 4.78, width = 8.75, units = \"in\", device = \"png\" )\n\n\n\n\n\n\n## -- ARRIVALS BY HOUR OF DAY AND DAY OF WEEK -- ##\n#collate descriptive stats for annotations\nupper_limit <- 20\nbin_size <- 10\n# overall <- from_to[duration < upper_limit & Triage.Acuity != \"\", .(mean=mean(duration), median=median(duration), N=.N)]\n\narrivals <- copy %>% copy()\n\nridge_stats <- arrivals$Arrival.Date...Time %>%\n  add_date_prop_DT() %>%\n  cbind(arrivals)\n\n# rename labels so facets read day of week instead of number\nridge_stats[,\":=\" (wday = wday %>% as.factor())]\nlevels(ridge_stats$wday)[levels(ridge_stats$wday) == \"1\"] <- \"Monday\"\nlevels(ridge_stats$wday)[levels(ridge_stats$wday) == \"2\"] <- \"Tuesday\"\nlevels(ridge_stats$wday)[levels(ridge_stats$wday) == \"3\"] <- \"Wednesday\"\nlevels(ridge_stats$wday)[levels(ridge_stats$wday) == \"4\"] <- \"Thursday\"\nlevels(ridge_stats$wday)[levels(ridge_stats$wday) == \"5\"] <- \"Friday\"\nlevels(ridge_stats$wday)[levels(ridge_stats$wday) == \"6\"] <- \"Saturday\"\nlevels(ridge_stats$wday)[levels(ridge_stats$wday) == \"7\"] <- \"Sunday\"\n\n# group by date properties of interest and count visits\nridge_stats <- ridge_stats[, .N, by=.(mday, wday, yday, month, year, hour)]\nstats <- ridge_stats[, .(peak=12, mean=mean(N)), by=wday]\n\n## -- GRAPH \nridge_stats %>%\n  ## STAT GRAPHICS\n  ggplot(aes(x=N, y = hour, group = hour, fill = ..x..))+#, fill=Triage.Acuity))+ #base graph with x and y specified\n  geom_density_ridges_gradient(scale=4)+\n  facet_grid(~wday)+\n  # stat_bin(binwidth=bin_size, colour=\"white\", fill = \"#FDB913\")+ #layer bar graph\n  ## TITLES & AXES\n  labs( # draw labels\n    title=\"Arrivals by Hour and by Day of Week\",#\"EKG Ordered to Complete\",#\"Room to Ready for Discharge\", \n    subtitle = \"1 Jan 2018 to 31 Dec 2018\",\n    y = \"Hour of Day\",\n    x = \"Visits per Hour\"\n  )+\n  ## SCALES\n  scale_x_continuous(breaks=seq(0, upper_limit, 2))+ #scale x axis\n  scale_y_continuous(breaks=seq(0, 24,1))+ #set y axis to percent\n  scale_fill_viridis_c(name=\"Visits\", option = \"C\")+\n  ## ANNOTATIONS\n  geom_vline(data=stats, color=\"red\", linetype=\"dashed\", aes(xintercept=peak))+#add vertical lines at 12 visits per hour\n  geom_vline(data=stats, color=\"#525354\", linetype=\"dashed\", aes(xintercept=mean))+#add vertical lines at each mean value\n  geom_text(data=stats, y=26.2, vjust=0, family=\"Segoe UI Light\", aes(x=mean-2.2, label=paste0(\"Mean = \", round(mean, 1))), inherit.aes=F)+#add mean to each facet (must include inherit.aes=F)\n  ## THEMES\n  theme_classic()+ #clean theme\n  theme(text=element_text(family=\"Segoe UI Light\"))\n\n## SAVE\nggsave(path=\"./plots\", filename=\"arrivals_ridge_by_dow.png\", height = 6.56, width = 12.75, units = \"in\", device = \"png\" )",
    "created" : 1582301292927.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2649062066",
    "id" : "F1CBF60",
    "lastKnownWriteTime" : 1572571140,
    "last_content_update" : 1572571140,
    "path" : "//milwaukee/project/MASTERS/Data Science/+Sean Bergstedt Local Drive/R/Workspace/2019-10 EPPA/vis_arrival_freq.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}